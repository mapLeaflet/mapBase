!function(t,e){"object"==typeof exports?(console.log("CommonJS"),module.exports=e(require("leaflet"))):"function"==typeof define?(console.log("amd or cmd"),define(["leaflet"],e),define(function(i,n,o){o.exports=e(t.L)})):(console.log("原生"),t.BoundaryCanvas=e(t.L))}(this,function(t){return function(){"use strict";var e=function(t,e){if(4!==t.length)return!1;var i,n=0,o=0;for(i=0;i<4;i++){if(t[i].x!==e.min.x&&t[i].x!==e.max.x||t[i].y!==e.min.y&&t[i].y!==e.max.y)return!1;n+=t[i].x,o+=t[i].y}return n===2*(e.min.x+e.max.x)&&o===2*(e.min.y+e.max.y)},i={_toMercGeometry:function(e,i){var n,o,r,a,s,u,l=[];for(i||(e[0]instanceof Array?e[0][0]instanceof Array||(e=[e]):e=[[e]]),n=0;n<e.length;n++){for(a=[],o=0;o<e[n].length;o++){for(s=[],r=0;r<e[n][o].length;r++)u=i?t.latLng(e[n][o][r][1],e[n][o][r][0]):e[n][o][r],s.push(this._map.project(u,0));a.push(s)}l.push(a)}return l},_getOriginalMercBoundary:function(){if(this._mercBoundary)return this._mercBoundary;var e,i;if(t.Util.isArray(this.options.boundary))this._mercBoundary=this._toMercGeometry(this.options.boundary);else{this._mercBoundary=[];var n=function(t){"GeometryCollection"===t.type?t.geometries.forEach(n):"Feature"===t.type?n(t.geometry):"FeatureCollection"===t.type?t.features.forEach(n):"Polygon"===t.type?this._mercBoundary=this._mercBoundary.concat(this._toMercGeometry([t.coordinates],!0)):"MultiPolygon"===t.type&&(this._mercBoundary=this._mercBoundary.concat(this._toMercGeometry(t.coordinates,!0)))}.bind(this);n(this.options.boundary)}for(this._mercBbox=new t.Bounds,i=0;i<this._mercBoundary.length;i++)e=new t.Bounds(this._mercBoundary[i][0]),this._mercBbox.extend(e.min),this._mercBbox.extend(e.max);return this._mercBoundary},_getClippedGeometry:function(i,n){var o,r,a,s,u,l=[];for(s=0;s<i.length;s++)if(o=[],0!==(r=t.PolyUtil.clipPolygon(i[s][0],n)).length){for(o.push(r),u=1;u<i[s].length;u++)(a=t.PolyUtil.clipPolygon(i[s][u],n)).length>0&&o.push(a);l.push(o)}if(0===l.length)return{isOut:!0};for(s=0;s<l.length;s++){if(!e(l[s][0],n))return{geometry:l};if(1===l[s].length)return{isIn:!0};for(u=1;u<l[s].length;u++)if(!e(l[s][u],n))return{geometry:l}}return{isOut:!0}},_getTileGeometry:function(e,i,n,o){if(!this.options.boundary)return{isIn:!0};var r,a=e+":"+i+":"+n,s=Math.pow(2,n),u=this._boundaryCache;if(u[a])return u[a];var l=this._getOriginalMercBoundary(),h=this.options.tileSize,y=new t.Bounds(new t.Point(e*h/s,i*h/s),new t.Point((e+1)*h/s,(i+1)*h/s));return o||y.intersects(this._mercBbox)?0===n?(u[a]={geometry:l},u[a]):(r=this._getTileGeometry(Math.floor(e/2),Math.floor(i/2),n-1,!0)).isOut||r.isIn?r:(u[a]=this._getClippedGeometry(r.geometry,y),u[a]):{isOut:!0}},_drawTileInternal:function(t,e,i,n){var o=this._getZoomForUrl(),r=this._getTileGeometry(e.x,e.y,o);if(r.isOut)n();else{var a=this.options.tileSize,s=a*e.x,u=a*e.y,l=Math.pow(2,o),h=t.getContext("2d"),y=new Image,c=function(){var e,i,o,a,c;if(!r.isIn){for(c=r.geometry,h.beginPath(),e=0;e<c.length;e++)for(i=0;i<c[e].length;i++)if(0!==c[e][i].length)for(h.moveTo(c[e][i][0].x*l-s,c[e][i][0].y*l-u),o=1;o<c[e][i].length;o++)h.lineTo(c[e][i][o].x*l-s,c[e][i][o].y*l-u);h.clip()}a=h.createPattern(y,"repeat"),h.beginPath(),h.rect(0,0,t.width,t.height),h.fillStyle=a,h.fill(),n()};this.options.crossOrigin&&(y.crossOrigin=""),y.onload=function(){t.complete=!0,setTimeout(c,0)},y.src=i}},onAdd:function(e){(t.TileLayer.Canvas||t.TileLayer).prototype.onAdd.call(this,e),this.options.trackAttribution&&(e.on("moveend",this._updateAttribution,this),this._updateAttribution())},onRemove:function(e){if((t.TileLayer.Canvas||t.TileLayer).prototype.onRemove.call(this,e),this.options.trackAttribution&&(e.off("moveend",this._updateAttribution,this),!this._attributionRemoved)){var i=t.TileLayer.BoundaryCanvas.prototype.getAttribution.call(this);e.attributionControl.removeAttribution(i)}},_updateAttribution:function(){var e=this._getOriginalMercBoundary(),i=this._map.getBounds(),n=t.bounds(this._map.project(i.getSouthWest(),0),this._map.project(i.getNorthEast(),0)),o=this._getClippedGeometry(e,n);if(this._attributionRemoved!==!!o.isOut){var r=t.TileLayer.BoundaryCanvas.prototype.getAttribution.call(this);this._map.attributionControl[o.isOut?"removeAttribution":"addAttribution"](r),this._attributionRemoved=!!o.isOut}}};t.version>="0.8"?t.TileLayer.BoundaryCanvas=t.TileLayer.extend({options:{boundary:null},includes:i,initialize:function(e,i){t.TileLayer.prototype.initialize.call(this,e,i),this._boundaryCache={},this._mercBoundary=null,this._mercBbox=null,this.options.trackAttribution&&(this._attributionRemoved=!0,this.getAttribution=null)},createTile:function(e,i){var n=document.createElement("canvas"),o=this.getTileUrl(e);return n.width=n.height=this.options.tileSize,this._drawTileInternal(n,e,o,t.bind(i,null,null,n)),n}}):t.TileLayer.BoundaryCanvas=t.TileLayer.Canvas.extend({options:{boundary:null},includes:i,initialize:function(e,i){t.Util.setOptions(this,i),t.Util.setOptions(this,{async:!0}),this._url=e,this._boundaryCache={},this._mercBoundary=null,this._mercBbox=null,this.options.trackAttribution&&(this._attributionRemoved=!0,this.getAttribution=null)},drawTile:function(e,i){var n,o=t.extend({},i);this._adjustTilePoint(o),n=this.getTileUrl(o),this._drawTileInternal(e,i,n,t.bind(this.tileDrawn,this,e)),this._getTileSize()!==this.options.tileSize&&(e.style.width=e.style.height=this._getTileSize()+"px")}}),t.TileLayer.boundaryCanvas=function(e,i){return new t.TileLayer.BoundaryCanvas(e,i)},t.TileLayer.BoundaryCanvas.createFromLayer=function(e,i){return new t.TileLayer.BoundaryCanvas(e._url,t.extend({},e.options,i))}}(),function(e,i){return t.TileLayer.BoundaryCanvas.createFromLayer(e,{boundary:i,trackAttribution:!0})}});
//# sourceMappingURL=BoundaryCanvas.js.map
